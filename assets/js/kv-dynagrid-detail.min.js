
/*!
 * @package   yii2-dynagrid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2015 - 2017
 * @version   1.4.6
 *
 * JQuery Plugin for yii2-dynagridDetail. Allows saving/deleting the dynagridDetail 
 * filter or sort details.
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2015, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */
(function(b){var c=function(e,d){return e===null||e===undefined||e===[]||e===""||d&&b.trim(e)===""},a=function(f,e){var d=this;d.$element=b(f);b.each(e,function(g,h){d[g]=h});d.init();d.listen()};a.prototype={constructor:a,init:function(){var e=this,f=b("#"+e.modalId),h=b("#"+e.dynaGridId),d=e.$element.closest("form"),g=b("body");f.insertAfter(h);e.$form=d;e.$formContainer=d.parent();e.$btnSave=d.find(".dynagrid-detail-save");e.$btnOpen=d.find(".dynagrid-detail-open");e.$btnDelete=d.find(".dynagrid-detail-deletegrid");e.$btnLoadGrid=d.find(".dynagrid-detail-loadgrid");e.$btnFastGrid=d.find(".dynagrid-detail-fastgrid");console.log(e.$btnFastGrid);e.$btnSaveGrid=d.find(".dynagrid-detail-savegridgrid");e.$list=d.find(".dynagrid-detail-list");e.$name=d.find(".dynagrid-detail-name")},process:function(e){var d=this;b.ajax({type:"post",url:e,dataType:"json",data:d.$form.serialize(),beforeSend:function(){d.$form.hide();d.$formContainer.prepend(d.submitMessage)},success:function(f){if(f.status==="success"){d.$formContainer.html(f.content)}}})},listen:function(){var f=this,e=f.$form,d=f.$formContainer,g=f.$list;f.$btnSave.on("click",function(){e.hide();d.prepend(f.submitMessage);setTimeout(function(){e.submit()},1000)});console.log();f.$btnFastGrid.on("click",function(){var h=window.location.href;if(h.indexOf("?")>-1){h+="&fastload="+b("#dynagridconfig-savedid").val()}else{h+="?fastload="+b("#dynagridconfig-savedid").val()}window.location.href=h});f.$btnLoadGrid.on("click",function(){b.ajax({type:"post",url:f.configLoadUrl,dataType:"json",data:{_csrf:b("input[name=_csrf]").val(),DynaGridSettings:{savedId:b("#dynagridconfig-savedid").val(),name:b("#dynagridconfig-savedid :selected").text(),category:"saved",storage:b('[name="DynaGridSettings[storage]"]').val(),userSpecific:b('[name="DynaGridSettings[userSpecific]"]').val(),dynaGridId:b('[name="DynaGridSettings[dynaGridId]"]').val()}},success:function(h){if(h.status==="success"&&b.isArray(h.content.keys)){b(f.$visibleEl).find("li[aria-grabbed=false]").each(function(){var i=b(this).clone(true);i.appendTo("#"+f.$hiddenEl.attr("id"));b(this).remove()});b.each(h.content.keys,function(k,i){var j=b("#"+i).clone(true);b("#"+i).remove();j.appendTo("#"+f.$visibleEl.attr("id"))});f.$form.find('input[name="DynaGridConfig[pageSize]"]').val(h.content.page);f.$form.find('[name="DynaGridConfig[theme]"]').val(h.content.theme).change();f.$form.find('[name="DynaGridConfig[filterId]"]').val(h.content.filterId).change();f.$form.find('[name="DynaGridConfig[sortId]"]').val(h.content.sortId).change()}}})});f.$btnSaveGrid.on("click",function(){krajeeDialogCust.prompt({label:f.saveMessage,placeholder:f.saveMessage},function(h){if(h){f.setColumnKeys();f.$visibleKeys.val(f.visibleKeys);e.hide();d.prepend(f.submitMessage);setTimeout(function(){e.find('[name="DynaGridConfig[savedName]"]').val(h);e.submit()},1000)}})});f.$btnDelete.on("click",function(){if(c(f.$list.val())){e.trigger("reset.yiiActiveForm");return}if(!window.confirm(f.deleteConfirmation)){return}var h=e.find('input[name="deleteDetailFlag"]');h.val(1);e.hide();d.prepend(f.deleteMessage);setTimeout(function(){e.submit()},1000)});g.on("change",function(){var i=g.val(),h=g.find("option:selected").text();if(!c(i)){f.$name.val(h);b.ajax({type:"post",url:f.configUrl,dataType:"json",data:f.$form.serialize(),success:function(j){if(j.status){e.find(".dynagrid-settings-text").html(j.content);if(j.link!==j.content){f.$btnOpen.removeClass("disabled");b('input[name="dynagridSettingLink"]').val(j.link)}}}})}});f.$btnOpen.on("click",function(){window.location.replace(b('input[name="dynagridSettingLink"]').val())});e.off("afterValidate").on("afterValidate",function(h,i){b.each(i,function(j,k){if(k.length>0){e.show();d.find(".dynagrid-submit-message").remove();return true}})})}};b.fn.dynagridDetail=function(e){var d=Array.apply(null,arguments);d.shift();return this.each(function(){var h=b(this),g=h.data("dynagridDetail"),f=typeof e==="object"&&e;if(!g){g=new a(this,b.extend({},b.fn.dynagridDetail.defaults,f,b(this).data()));h.data("dynagridDetail",g)}if(typeof e==="string"){g[e].apply(g,d)}})};b.fn.dynagridDetail.defaults={submitMessage:"",deleteMessage:"",deleteConfirmation:"Are you sure you want to delete all your grid personalization settings?",saveMessage:"Please type grid name",configUrl:"",modalId:"",configLoadUrl:"",dynaGridId:""}}(window.jQuery));